{
        "core": {
                "name": "carauction-network",
                "version": "0.1.0",
                "readme": "# Hyperledger Composer Car Auction Demo\n\nThis is an interactive, distributed, car auction demo, backed by Hyperledger Fabric. Invite participants to join your distributed auction, list assets for sale (setting a reserve price), and watch as assets that have met their reserve price are automatically transferred to the highest bidder at the end of the auction.\n\n## Understanding the Business Network\n\nThe easiest way to interact with the demo is using our work-in-progress [Hyperledger Composer web application](http://composer-playground.mybluemix.net). Hyperledger Composer allows you to define a business network (defining the data model and writing transaction processing logic), manage assets & participants and submit transactions.\n\nThe data model for the auction business network is defined in a CTO model file, managed in GitHub [here](https://github.com/hyperledger/composer-sample-networks/blob/master/packages/carauction-network/models/auction.cto).\n\nThe data model is very simple (less than 50 lines). It defines the structure of the assets, participants and transactions for a very simple auction.\n\nThe business logic is defined in a single Javascript file [here](https://github.com/hyperledger/composer-sample-networks/blob/master/packages/carauction-network/lib/logic.js). The logic consists of two Javascript functions that are automatically invoked by the Hyperledger Composer runtime chain code when transactions are submitted for processing.\n\nThe `makeOffer` function is called when an `Offer` transaction is submitted. The logic simply checks that the listing for the offer is still for sale, and then adds the offer to the listing, and then updates the offer in the `VehicleListing` asset registry.\n\nThe `closeBidding` function is called when a `CloseBidding` transaction is submitted for processing. The logic checks that the listing is still for sale, sorts the offers by bid price, and then if the reserve has been met, transfers the ownership of the vehicle associated with the listing to the highest bidder. Money is transferred from the buyer's account to the seller's account, and then all the modified assets are updated in their respective registries.\n\nAccess control for the business network is defined [here](https://github.com/hyperledger/composer-sample-networks/blob/master/packages/carauction-network/permissions.acl).\n\n### Developer Unit Testing\n\n > Note that if you `git clone` the [repository](https://github.com/hyperledger/composer-sample-networks) for the Business Network you can run a unit tests for the logic in the business network using the Hyperledger Composer embedded runtime which simulates a Hyperledger Fabric using a pure Javascript runtime. Simply run:\n\n ```\ncd packages/carAuction-network\nnpm install\nnpm test\n```\n\nThe unit test [here](https://github.com/hyperledger/composer-sample-networks/blob/master/packages/carauction-network/test/CarAuction.js) simulates an entire auction and checks that the business logic functions as expected.\n\n## Connect to Composer\n\nYou can connect to Hyperledger Composer [here](http://composer-playground.mybluemix.net). If you have used Hyperledger Composer before you may need to clear your cached browser data.\n\n> Hyperledger Composer currently only supports the web profile.\n\nAfter you are connected make sure that Hyperledger Composer is communicating with the **'hyperledger'** connection profile by clicking the network dropdown at the top-right of the menu. The web profile allows you to test in isolation using a simulated Hyperledger, storing the ledger in browser local storage. The 'bluemix' connection profile is to a version of Hyperledger Composer deployed to bluemix.\n\n## Setting Up the Demo\n\nBefore you can hold an auction you need to create and invite some participants to your business network and have something to sell!\n\n### Create Your Participant & Issue an Identity Card\n\nSwitch to the Test tab, then click on the `User` participant registry, then click on the `Create Participant` button to create a new instance of a user.\n\nThe JSON representation of the User should be:\n\n```\n{\n  \"$class\": \"org.acme.vehicle.auction.User\",\n  \"email\": \"a.participant@example.com\",\n  \"firstName\": \"Daniel\",\n  \"lastName\": \"Selman\",\n  \"balance\": 10000\n}\n```\n\nSubstitute `a.participant@example.com` with your email address. Congratulations you are now a participant in this business network!\n\n> Hyperledger Composer does not yet support issuing and managing Hyperledger Fabric identities.\n\nYou now need to issue an identity card for this participant. Click the green ID card icon to the right of your participant. Enter an user id, for example `a.participant` and select the \"Identity can be used to issue other identities?\" checkbox so that this user has permission to invite other users into the business network.\n\nYou can switch between identities using the menu option at the top right of the screen.\n\n### Create Assets\n\nNow that you are a participant in the business network and have been issued an identity card you can own assets and take part in an auction.\n\n#### Create a Vehicle\n\nFirst, let's create a vehicle for auction.\n\nClick on the `Vehicle` asset registry, and then click on the `Create Asset` button to create a new instance of a vehicle that can be auctioned.\n\nThe JSON representation of the Vehicle should be:\n\n```\n{\n  \"$class\": \"org.acme.vehicle.auction.Vehicle\",\n  \"vin\": \"CAR_001\",\n  \"owner\": \"a.owner@example.com\"\n}\n```\n\nSubstitute `a.owner@example.com` for the id of the participant you created above. Congratulations you are now the owner of the vehicle `CAR_001`!\n\n#### Create a Vehicle Listing\n\nThe `VehicleListing` asset is used to list vehicles that are available for auction.\n\nClick on the click on the `VehicleListing` asset registry, and then click on the `Create Asset` icon to create a new instance of a vehicle listing.\n\nThe JSON representation of the `VehicleListing` should be:\n\n```\n{\n  \"$class\": \"org.acme.vehicle.auction.VehicleListing\",\n  \"listingId\": \"LISTING_001\",\n  \"reservePrice\": 4000,\n  \"description\": \"Ford Mustang\",\n  \"state\": \"FOR_SALE\",\n  \"vehicle\": \"CAR_001\"\n}\n```\n\nCongratulations, you've just listed your Ford Mustang for auction, with a reserve price of $4000!\n\n### Create Additional Participants\n\n> Hyperledger Composer does not yet support inviting participants via a URL\n\nAn auction with one person is not much fun, so you need to either invite people to use Hyperledger Composer to create their own participants and identities, or you can do it for them. To make it easy for participants that you've created to join the business network (auction) when an identity is issued a personalised URL is generated that you can send to allow participants to join the business network in a single click.\n\nYou can send this text via email or Slack to give people an easy mechanism to launch Hyperledger Composer and join your business network.\n\n## Bidding on a VehicleListing\n\nAs soon as a `VehicleListing` has been created (and is in the `FOR_SALE` state) participants can submit `Offer` transactions to bid on a vehicle listing.\n\nClick on the Submit Transaction button to submit a new transaction for processing by the business network.\n\nThe JSON payload should be:\n\n```\n{\n  \"$class\": \"org.acme.vehicle.auction.Offer\",\n  \"bidPrice\": 250.00,\n  \"listing\": \"LISTING_001\",\n  \"user\": \"a.bidder@example.com\"\n}\n```\n\nSubstitute the id of the participant submitting the transaction for `a.bidder@example.com` and set the bid price as high as you'd like to bid. Remember the vehicle will only be sold if the reserve price is met and it will go to the highest bidder!\n\nThe `Offer` transaction is processed by the `makeOffer` function described above.\n\n## End the Auction\n\nTo end the auction someone has to submit a `CloseBidding` transaction for the listing.\n\nClick on the Submit Transaction button to submit a new transaction for processing by the business network.\n\nThe JSON payload should be:\n\n```\n{\n  \"$class\": \"org.acme.vehicle.auction.CloseBidding\",\n  \"listing\": \"LISTING_001\"\n}\n```\n\nThis simply indicates that the auction for `LISTING_001` is now closed, triggering the `closeBidding` function that was described above.\n\n\n## Check the Results of the Auction\n\nTo see if the Vehicle was sold you need to click on the `Vehicle` asset registry and then check the owner of CAR_001. If the reserve price was met you should see that the owner of the vehicle has been modified.\n\nIf you check the state of the VehicleListing is should either be `SOLD` or `RESERVE_NOT_MET`.\n\nIf you click on the 'User' asset registry you can check the balance of each User. You should see that the balance of the buyer has been debited by the amount they bid, whilst the balance of the seller has been credited.\n\n## View the Blockchain\n\n> Not yet supported in Hyperledger Composer\n\nYou can inspect the blocks and transaction created by Hyperledger during the course of the auction using the Hyperledger Explorer. Details TBD.\n\n## Reset the Auction\n\nTo reset the auction you need to edit the VehicleListing to reset its state to `FOR_SALE`. Simply click on the `VehicleListing` registry and then click the pencil icon to update the VehicleListing back to its original state.\n\nThe JSON representation of the `VehicleListing` should be:\n\n```\n{\n  \"$class\": \"org.acme.vehicle.auction.VehicleListing\",\n  \"listingId\": \"LISTING_001\",\n  \"reservePrice\": 4000,\n  \"description\": \"Ford Mustang\",\n  \"state\": \"FOR_SALE\",\n  \"vehicle\": \"CAR_001\"\n}\n```\n"
        },
        "types": {
                "asset": [
                        {
                                "fqn": "org.hyperledger.composer.system.Asset",
                                "name": "Asset",
                                "description": "An asset named Asset",
                                "type": "asset",
                                "properties": {}
                        },
                        {
                                "fqn": "org.acme.vehicle.auction.Vehicle",
                                "name": "Vehicle",
                                "description": "An asset named Vehicle",
                                "type": "asset",
                                "properties": {
                                        "vin": {
                                                "type": "string",
                                                "description": "The instance identifier for this type"
                                        },
                                        "owner": {
                                                "type": "string",
                                                "description": "The identifier of an instance of org.acme.vehicle.auction.Member"
                                        }
                                }
                        },
                        {
                                "fqn": "org.acme.vehicle.auction.VehicleListing",
                                "name": "VehicleListing",
                                "description": "An asset named VehicleListing",
                                "type": "asset",
                                "properties": {
                                        "listingId": {
                                                "type": "string",
                                                "description": "The instance identifier for this type"
                                        },
                                        "reservePrice": {
                                                "type": "number"
                                        },
                                        "description": {
                                                "type": "string"
                                        },
                                        "state": {
                                                "type": "enum",
                                                "enum": [
                                                        "FOR_SALE",
                                                        "RESERVE_NOT_MET",
                                                        "SOLD"
                                                ]
                                        },
                                        "offers": {
                                                "type": "array",
                                                "items": {
                                                        "properties": {
                                                                "bidPrice": {
                                                                        "type": "number"
                                                                },
                                                                "listing": {
                                                                        "type": "string",
                                                                        "description": "The identifier of an instance of org.acme.vehicle.auction.VehicleListing"
                                                                },
                                                                "member": {
                                                                        "type": "string",
                                                                        "description": "The identifier of an instance of org.acme.vehicle.auction.Member"
                                                                },
                                                                "transactionId": {
                                                                        "type": "string",
                                                                        "description": "The instance identifier for this type"
                                                                },
                                                                "timestamp": {
                                                                        "format": "date-time",
                                                                        "type": "string"
                                                                }
                                                        },
                                                        "required": [
                                                                "bidPrice",
                                                                "listing",
                                                                "member",
                                                                "transactionId",
                                                                "timestamp"
                                                        ],
                                                        "type": "object",
                                                        "description": "An instance of org.acme.vehicle.auction.Offer"
                                                }
                                        },
                                        "vehicle": {
                                                "type": "string",
                                                "description": "The identifier of an instance of org.acme.vehicle.auction.Vehicle"
                                        }
                                }
                        }
                ],
                "transaction": [
                        {
                                "fqn": "org.hyperledger.composer.system.Transaction",
                                "name": "Transaction",
                                "description": "A transaction named Transaction",
                                "type": "transaction",
                                "properties": {
                                        "transactionId": {
                                                "type": "string",
                                                "description": "The instance identifier for this type"
                                        },
                                        "timestamp": {
                                                "format": "date-time",
                                                "type": "string"
                                        }
                                }
                        },
                        {
                                "fqn": "org.acme.vehicle.auction.Offer",
                                "name": "Offer",
                                "description": "A transaction named Offer",
                                "type": "transaction",
                                "properties": {
                                        "bidPrice": {
                                                "type": "number"
                                        },
                                        "listing": {
                                                "type": "string",
                                                "description": "The identifier of an instance of org.acme.vehicle.auction.VehicleListing"
                                        },
                                        "member": {
                                                "type": "string",
                                                "description": "The identifier of an instance of org.acme.vehicle.auction.Member"
                                        },
                                        "transactionId": {
                                                "type": "string",
                                                "description": "The instance identifier for this type"
                                        },
                                        "timestamp": {
                                                "format": "date-time",
                                                "type": "string"
                                        }
                                }
                        },
                        {
                                "fqn": "org.acme.vehicle.auction.CloseBidding",
                                "name": "CloseBidding",
                                "description": "A transaction named CloseBidding",
                                "type": "transaction",
                                "properties": {
                                        "listing": {
                                                "type": "string",
                                                "description": "The identifier of an instance of org.acme.vehicle.auction.VehicleListing"
                                        },
                                        "transactionId": {
                                                "type": "string",
                                                "description": "The instance identifier for this type"
                                        },
                                        "timestamp": {
                                                "format": "date-time",
                                                "type": "string"
                                        }
                                }
                        }
                ],
                "concept": [],
                "enum": [],
                "participant": [
                        {
                                "fqn": "org.hyperledger.composer.system.Participant",
                                "name": "Participant",
                                "description": "An participant named Participant",
                                "type": "participant",
                                "properties": {}
                        },
                        {
                                "fqn": "org.acme.vehicle.auction.User",
                                "name": "User",
                                "description": "An participant named User",
                                "type": "participant",
                                "properties": {
                                        "email": {
                                                "type": "string",
                                                "description": "The instance identifier for this type"
                                        },
                                        "firstName": {
                                                "type": "string"
                                        },
                                        "lastName": {
                                                "type": "string"
                                        }
                                }
                        },
                        {
                                "fqn": "org.acme.vehicle.auction.Member",
                                "name": "Member",
                                "description": "An participant named Member",
                                "type": "participant",
                                "properties": {
                                        "balance": {
                                                "type": "number"
                                        },
                                        "email": {
                                                "type": "string",
                                                "description": "The instance identifier for this type"
                                        },
                                        "firstName": {
                                                "type": "string"
                                        },
                                        "lastName": {
                                                "type": "string"
                                        }
                                }
                        },
                        {
                                "fqn": "org.acme.vehicle.auction.Auctioneer",
                                "name": "Auctioneer",
                                "description": "An participant named Auctioneer",
                                "type": "participant",
                                "properties": {
                                        "email": {
                                                "type": "string",
                                                "description": "The instance identifier for this type"
                                        },
                                        "firstName": {
                                                "type": "string"
                                        },
                                        "lastName": {
                                                "type": "string"
                                        }
                                }
                        }
                ]
        },
        "scripts": {
                "files": [
                        {
                                "identifier": "lib/logic.js",
                                "name": "lib/logic.js",
                                "functions": [
                                        {
                                                "text": "function closeBidding(closeBidding) {\n    var listing = closeBidding.listing;\n    if (listing.state !== 'FOR_SALE') {\n        throw new Error('Listing is not FOR SALE');\n    }\n    // by default we mark the listing as RESERVE_NOT_MET\n    listing.state = 'RESERVE_NOT_MET';\n    var highestOffer = null;\n    var buyer = null;\n    var seller = null;\n    if (listing.offers && listing.offers.length > 0) {\n        // sort the bids by bidPrice\n        listing.offers.sort(function(a, b) {\n            return (b.bidPrice - a.bidPrice);\n        });\n        highestOffer = listing.offers[0];\n        if (highestOffer.bidPrice >= listing.reservePrice) {\n            // mark the listing as SOLD\n            listing.state = 'SOLD';\n            buyer = highestOffer.member;\n            seller = listing.vehicle.owner;\n            // update the balance of the seller\n            console.log('#### seller balance before: ' + seller.balance);\n            seller.balance += highestOffer.bidPrice;\n            console.log('#### seller balance after: ' + seller.balance);\n            // update the balance of the buyer\n            console.log('#### buyer balance before: ' + buyer.balance);\n            buyer.balance -= highestOffer.bidPrice;\n            console.log('#### buyer balance after: ' + buyer.balance);\n            // transfer the vehicle to the buyer\n            listing.vehicle.owner = buyer;\n            // clear the offers\n            listing.offers = null;\n        }\n    }\n    return getAssetRegistry('org.acme.vehicle.auction.Vehicle')\n        .then(function(vehicleRegistry) {\n            // save the vehicle\n            if (highestOffer) {\n                return vehicleRegistry.update(listing.vehicle);\n            } else {\n                return true;\n            }\n        })\n        .then(function() {\n            return getAssetRegistry('org.acme.vehicle.auction.VehicleListing')\n        })\n        .then(function(vehicleListingRegistry) {\n            // save the vehicle listing\n            return vehicleListingRegistry.update(listing);\n        })\n        .then(function() {\n            return getParticipantRegistry('org.acme.vehicle.auction.Member')\n        })\n        .then(function(userRegistry) {\n            // save the buyer\n            if (listing.state == 'SOLD') {\n                return userRegistry.updateAll([buyer, seller]);\n            } else {\n                return true;\n            }\n        });\n}"
                                        },
                                        {
                                                "text": "function makeOffer(offer) {\n    var listing = offer.listing;\n    if (listing.state !== 'FOR_SALE') {\n        throw new Error('Listing is not FOR SALE');\n    }\n    if (listing.offers == null) {\n        listing.offers = [];\n    }\n    listing.offers.push(offer);\n    return getAssetRegistry('org.acme.vehicle.auction.VehicleListing')\n        .then(function(vehicleListingRegistry) {\n            // save the vehicle listing\n            return vehicleListingRegistry.update(listing);\n        });\n}"
                                        }
                                ]
                        }
                ]
        },
        "acls": {
                "rules": [
                        {
                                "description": "Allow the auctioneer full access",
                                "name": "Auctioneer",
                                "verb": [
                                        "ALL"
                                ],
                                "noun": "org.acme.vehicle.auction.*",
                                "participant": "ModelBinding org.acme.vehicle.auction.Auctioneer",
                                "transaction": null,
                                "predicate": "true",
                                "action": "ALLOW"
                        },
                        {
                                "description": "Allow the member read access",
                                "name": "Member",
                                "verb": [
                                        "READ"
                                ],
                                "noun": "org.acme.vehicle.auction.*",
                                "participant": "ModelBinding org.acme.vehicle.auction.Member",
                                "transaction": null,
                                "predicate": "true",
                                "action": "ALLOW"
                        },
                        {
                                "description": "Allow the owner of a vehicle total access",
                                "name": "VehicleOwner",
                                "verb": [
                                        "ALL"
                                ],
                                "noun": "org.acme.vehicle.auction.Vehicle",
                                "participant": "ModelBinding org.acme.vehicle.auction.Member:m",
                                "transaction": null,
                                "predicate": "v.owner.getIdentifier() == m.getIdentifier()",
                                "action": "ALLOW"
                        },
                        {
                                "description": "Allow the owner of a vehicle total access to their vehicle listing",
                                "name": "VehicleListingOwner",
                                "verb": [
                                        "ALL"
                                ],
                                "noun": "org.acme.vehicle.auction.VehicleListing",
                                "participant": "ModelBinding org.acme.vehicle.auction.Member:m",
                                "transaction": null,
                                "predicate": "v.vehicle.owner.getIdentifier() == m.getIdentifier()",
                                "action": "ALLOW"
                        }
                ]
        },
        "queries": {
                "queries": []
        }
}